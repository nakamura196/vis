
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Material Design Bootstrap</title>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />
  <!-- Bootstrap core CSS -->
  <link href="//mdbootstrap.com/previews/free-templates/blog/css/bootstrap.min.css" rel="stylesheet">
  <!-- Material Design Bootstrap -->
  <link href="//mdbootstrap.com/previews/free-templates/blog/css/mdb.min.css" rel="stylesheet">
  

  <style type="text/css">
  #mynetwork {
    width: 100%;
    height: 600px;
  }
  </style>
</head>

<body>

  <!--Main Navigation-->
  <header>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light white scrolling-navbar">
      <div class="container">

        <!-- Brand -->
        <a class="navbar-brand waves-effect" href="./">
          <strong class="blue-text">Sample</strong>
        </a>



      </div>
    </nav>
    <!-- Navbar -->

  </header>
  <!--Main Navigation-->

  <!--Main layout-->
  <main class="mt-5 pt-5">
    <div class="container">
      <!-- Card -->
      <div class="card">
        <!-- Card content -->
        <div class="card-body">
          <div id="mynetwork"></div>
        </div>

      </div>
      <!-- Card -->

    </div>
  </main>
  <!--Main layout-->

  <!--Footer-->
  <footer class="page-footer text-center font-small mdb-color darken-2 mt-4 wow fadeIn">

  </footer>
  <!--/.Footer-->

  <script type="text/javascript">


  //CSVファイルを読み込む関数getCSV()の定義
  function getCSV(){
    var req = new XMLHttpRequest(); // HTTPでファイルを読み込むためのXMLHttpRrequestオブジェクトを生成
    req.open("get", "gephi.tsv", true); // アクセスするファイルを指定
    req.send(null); // HTTPリクエストの発行

    // レスポンスが返ってきたらconvertCSVtoArray()を呼ぶ
    req.onload = function(){
      convertCSVtoArray(req.responseText); // 渡されるのは読み込んだCSVデータ
    }
  }

  // 読み込んだCSVデータを二次元配列に変換する関数convertCSVtoArray()の定義
  function convertCSVtoArray(str){ // 読み込んだCSVデータが文字列として渡される
    var result = []; // 最終的な二次元配列を入れるための配列
    var tmp = str.split("\n"); // 改行を区切り文字として行を要素とした配列を生成

    // 各行ごとにカンマで区切った文字列を要素とした二次元配列を生成

    map = {}

    for(var i=0;i<tmp.length;++i){
      //result[i] = tmp[i].split('\t');

      var line = tmp[i]

      if(!map[line]){
        map[line] = 0
      }

      map[line] = map[line] + 1
    }

    for(key in map){
      if(map[key] > 1){
        tmp = key.split('\t')
        tmp.push(map[key])
        result.push(tmp);
      }
    }


    draw(result)
  }

  getCSV(); //最初に実行される

  function draw(data){

    nodes = []
    edges = []

    array = []



    for(var i = 0; i < data.length; i++){
      tmp = data[i]
      from = tmp[0]
      to = tmp[1]
      //console.log(from+","+to)

      if(array.indexOf(from) == -1){
        node = {}
        node.id = from
        node.label = from
        nodes.push(node)

        array.push(from)
      }

      if(array.indexOf(to) == -1){
        node = {}
        node.id = to
        node.label = to
        nodes.push(node)

        array.push(to)
      }

      var edge = {}
      edge.from = from
      edge.to = to
      edge.arrows = "to"
      edge.value = tmp[2]

      edges.push(edge)
    }


    nodes = new vis.DataSet(nodes)
    edges = new vis.DataSet(edges)


    // create a network
    var container = document.getElementById('mynetwork');
    var data = {
      nodes: nodes,
      edges: edges
    };
    var options = {
      nodes: {
        shape: 'dot',
        scaling: {
          customScalingFunction: function (min,max,total,value) {
            return value/total;
          },
          min:5,
          max:150
        }
      }
    }
    var network = new vis.Network(container, data, options);

  }


  </script>
</body>

</html>
